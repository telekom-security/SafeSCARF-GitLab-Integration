include:
  - template: Security/Secret-Detection.gitlab-ci.yml

# this should only be used with "latest" secret-detection template because the
#current release only checks if "$SECRET_DETECTION_DISABLED" exists. It does not
#verify the content.
#variables:
#  SECRET_DETECTION_DISABLED: $GITLAB_SECRET_SCAN_DISABLED

secret_detection:
  artifacts:
    paths:
      - "gl-secret-detection-report.json"
    # rules are only needed until variables above are fixed by gitlab itself
  rules:
    - if: '$GITLAB_SECRET_SCAN_DISABLED == "true"'
      when: never
    - if: $CI_COMMIT_BRANCH

secret_detection-safescarf:
  extends: .safescarf_upload
  needs: ["safescarf_create_engagement", "secret_detection"]
  variables:
    SAFESCARF_SCAN_TYPE: "GitLab Secret Detection Report"
    SAFESCARF_SCAN_TEST_TYPE: "GitLab-CI Gitleaks Report"
    SAFESCARF_SCAN_FILE: "./gl-secret-detection-report.json"
  rules:
    - if: '$GITLAB_SECRET_SCAN_DISABLED == "true"'
      when: never
    - if: $CI_COMMIT_BRANCH
